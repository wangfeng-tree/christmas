<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Merry Christmas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- 艺术字体 -->
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
  color:#fff;
}
#text{
  position:fixed;
  left:5%;
  top:20%;
  font-family:'Great Vibes', cursive;
  font-size:42px;
  opacity:0.9;
  z-index:10;
}
canvas{display:block;}
</style>
</head>
<body>

<div id="text">
  Merry Christmas<br>
  <span style="font-size:32px;">To Wang Feng</span>
</div>

<!-- Three.js -->
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/postprocessing/UnrealBloomPass.js"></script>

<script>
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
  60,
  window.innerWidth/window.innerHeight,
  0.1,
  1000
);
camera.position.z = 35;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* 粒子圣诞树 */
const count = 12000;
const geometry = new THREE.BufferGeometry();
const positions = new Float32Array(count*3);

for(let i=0;i<count;i++){
  const h = Math.random()*30;
  const r = (1 - h/30) * 12;
  const angle = h*0.6 + Math.random()*1.5;

  positions[i*3]   = Math.cos(angle)*r + (Math.random()-0.5)*0.6;
  positions[i*3+1] = h - 15;
  positions[i*3+2] = Math.sin(angle)*r + (Math.random()-0.5)*0.6;
}

geometry.setAttribute('position', new THREE.BufferAttribute(positions,3));

const material = new THREE.PointsMaterial({
  color:0xffb6c1,
  size:0.35,
  transparent:true,
  blending:THREE.AdditiveBlending,
  depthWrite:false
});

const tree = new THREE.Points(geometry,material);
scene.add(tree);

/* 雪花 */
const snowGeo = new THREE.BufferGeometry();
const snowCount = 1500;
const snowPos = new Float32Array(snowCount*3);

for(let i=0;i<snowCount;i++){
  snowPos[i*3]   = (Math.random()-0.5)*80;
  snowPos[i*3+1] = Math.random()*60;
  snowPos[i*3+2] = (Math.random()-0.5)*80;
}
snowGeo.setAttribute('position', new THREE.BufferAttribute(snowPos,3));

const snow = new THREE.Points(
  snowGeo,
  new THREE.PointsMaterial({
    color:0xffffff,
    size:0.25,
    transparent:true
  })
);
scene.add(snow);

/* 泛光 */
const composer = new THREE.EffectComposer(renderer);
composer.addPass(new THREE.RenderPass(scene,camera));
const bloom = new THREE.UnrealBloomPass(
  new THREE.Vector2(window.innerWidth,window.innerHeight),
  1.5,
  0.6,
  0.15
);
composer.addPass(bloom);

/* 动画 */
function animate(){
  requestAnimationFrame(animate);
  tree.rotation.y += 0.002;
  snow.rotation.y += 0.0005;
  composer.render();
}
animate();

window.onresize=()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
  composer.setSize(window.innerWidth,window.innerHeight);
}
</script>
</body>
</html>
